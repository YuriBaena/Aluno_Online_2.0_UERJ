<div class="dashboard-wrapper">
  <header class="dashboard-header">
    <div class="welcome-text">
      <h2>Ol√°, {{usuario?.nome}}! üëã</h2>
      <p>Bem-vindo ao novo portal do aluno. Veja o que h√° de novo hoje.</p>
    </div>
    
    <div class="sync-action">
      <button class="btn-sync" (click)="abrirModalSync()" [class.syncing]="loadingSync">
        <i class="fa-solid" [ngClass]="loadingSync ? 'fa-circle-notch fa-spin' : 'fa-arrows-rotate'"></i> 
        {{ loadingSync ? 'Sincronizando...' : 'Sincronizar Aluno Online' }}
      </button>

      <small *ngIf="loadingSync" class="pulse-text">Sincroniza√ß√£o em segundo plano...</small>
      <small *ngIf="ultimaSincronizacao && !loadingSync">√öltima vez: {{ ultimaSincronizacao }}</small>

      <div class="modal-overlay" *ngIf="exibirModalSync">
        <div class="modal-card">
          <header>
            <h3>Sincronizar Dados</h3>
            <button class="close-btn" (click)="fecharModalSync()">√ó</button>
          </header>

          <div class="modal-body">
            <div class="error-toast" *ngIf="mensagemErro">
              <i class="fa-solid fa-circle-xmark"></i> {{ mensagemErro }}
            </div>

            <div class="success-toast" *ngIf="mensagemSucesso">
              <i class="fa-solid fa-circle-check"></i> {{ mensagemSucesso }}
            </div>

            <ng-container *ngIf="!loadingSync && !mensagemSucesso">
              <p class="instruction">
                Insira suas credenciais do <strong>Portal Antigo</strong> para importar suas mat√©rias.
              </p>
              
              <div class="input-group">
                <label>Matr√≠cula</label>
                <input type="text" [(ngModel)]="syncData.matricula" placeholder="000000000000">
              </div>

              <div class="input-group">
                <label>Senha do Portal</label>
                <input type="password" [(ngModel)]="syncData.senha" placeholder="******">
              </div>

              <div class="legal-container">
                <label class="checkbox-label">
                  <input type="checkbox" [(ngModel)]="termosAceitos">
                  <span>Autorizo o acesso automatizado aos meus dados para fins de importa√ß√£o.</span>
                </label>
                <p class="legal-link" (click)="mostrarDetalhes = !mostrarDetalhes">
                  {{ mostrarDetalhes ? 'Ocultar detalhes legais' : 'Ver termos e responsabilidades' }}
                </p>
                <div class="legal-details" *ngIf="mostrarDetalhes">
                  Ao prosseguir, voc√™ concorda que esta aplica√ß√£o acesse o Portal do Aluno em seu nome para coletar disciplinas e notas. Suas credenciais s√£o usadas apenas para esta conex√£o e n√£o s√£o armazenadas. O uso desta ferramenta √© de sua inteira responsabilidade.
                </div>
              </div>
            </ng-container>

            <div class="loading-state" *ngIf="loadingSync">
              <div class="loader-content">
                <i class="fa-solid fa-circle-notch fa-spin"></i>
                <div class="loader-text">
                  <strong>{{ statusTexto }}</strong>
                  <p>Processando dados. Voc√™ pode fechar esta janela; o progresso continuar√° em segundo plano.</p>
                </div>
              </div>
              
              <div class="progress-bar-container">
                <div class="progress-bar-fill"></div>
              </div>
            </div>
          </div>

          <footer>
            <button class="btn-cancel" (click)="fecharModalSync()">
              {{ loadingSync ? 'Ocultar e continuar' : (mensagemSucesso ? 'Fechar' : 'Cancelar') }}
            </button>

            <button class="btn-confirm" 
                    *ngIf="!loadingSync && !mensagemSucesso" 
                    [disabled]="!termosAceitos"
                    (click)="confirmarSincronizacao()">
              Confirmar Importa√ß√£o
            </button>
          </footer>
        </div>
      </div>
    </div>
  </header>

  <div class="stats-grid">
    <div class="stat-card">
      <div class="icon-box blue"><i class="fa-solid fa-ranking-star"></i></div>
      <div class="info"><span>CR Geral</span><h3>8.4</h3></div>
    </div>
    <div class="stat-card">
      <div class="icon-box green"><i class="fa-solid fa-book"></i></div>
      <div class="info"><span>Disciplinas Ativas</span><h3>6</h3></div>
    </div>
    <div class="stat-card">
      <div class="icon-box orange"><i class="fa-solid fa-clock"></i></div>
      <div class="info"><span>Horas AC</span><h3>120/200</h3></div>
    </div>
  </div>

  <section class="main-content">
    <div class="content-card">
      <h3>Grade Hor√°ria de Hoje</h3>
      <p class="empty-state">Nenhuma aula registrada para hoje. Aproveite para estudar!</p>
    </div>
  </section>
</div>